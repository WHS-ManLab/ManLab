<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ManLab Regular Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:target {
            background-color: #ffff99;
            transition : background-color 0.3s ease;
        }
        tr.highlight {
            background-color: #ffff99;
        }
        h1 {
            text-align: center;
        }
        canvas {
            display: block;
            margin: 0 auto;
        }
        hr {
            height : 50px;
            border : 0;
        }
        .chart-row {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }
        .chart-box {
            flex: 1 1 30%;
            max-width: 400px;
        }            
    </style>
</head>
<body>
<h1 style="text-align: center;">ManLab Regular Security Report</h1>
<p style="text-align: right;">Report period: 2025-07-31 14:40:07 ~ 2025-08-01 14:40:07</p>

<hr/>
<h1>📂 File Integrity Monitoring Report</h1>

<h2>• Modified Files (Manual Scan Results)</h2>
<div style="display: flex; justify-content: space-between; gap: 20px; flex-wrap: wrap;">
    <!-- 확장자별 차트 + 범례 -->
    <div style="display: flex; align-items: center;">
        <canvas id="manualScanExtChart" width="400" height="400"></canvas>
        <div id="manualScanExtLegend" style="margin-left: 20px;"></div>
    </div>

    <!-- 변경 사유별 차트 -->
    <div>
        <canvas id="manualScanReasonChart" width="400" height="400"></canvas>
    </div>

    <!-- 시간대별 차트 -->
    <div>
        <canvas id="manualScanTimeChart" width="400" height="400"></canvas>
    </div>
</div>

<table id = "manualScanTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Path</th>
            <th>Current MD5 Hash</th>
            <th>Permission</th>
            <th>UID</th>
            <th>GID</th>
            <th>CTime</th>
            <th>MTime</th>
            <th>Size</th>
        </tr>
    </thead>
    <tbody>
<tr><td>1</td><td>/etc/test.txt</td><td data-changed="true">d8e8fca2dc0f896fd7cb4cb0031ba249</td><td data-changed="false">rwxrwxrwx</td><td data-changed="false">0</td><td data-changed="false">0</td><td data-changed="true">2025-08-01 14:38:40</td><td data-changed="true">2025-08-01 14:38:40</td><td data-changed="true">5</td></tr>
</tbody></table>
<h2>• Real-time Monitoring Events</h2>
<div style="display: flex; justify-content: center;">
    <canvas id="realtimeChart" style="margin-right: 10px;" width="400" height="400"></canvas>
    <canvas id="realtimeTimeChart" width="400" height="400"></canvas>
</div>
<table id = "realtimeTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Path</th>
            <th>Event Type</th>
            <th>New Name</th>
            <th>Timestamp</th>
        </tr>
    </thead>
    <tbody>
<tr><td>1</td><td>/etc/test.txt</td><td>MODIFY         </td><td>-</td><td>2025-08-01 14:38:40</td></tr><tr><td>2</td><td>/etc/test.txt</td><td>ATTRIB CHANGE  </td><td>-</td><td>2025-08-01 14:38:40</td></tr></tbody></table>
<script>

function highlightManualRowByExt(ext) {
    document.querySelectorAll('#manualScanTable tbody tr').forEach(tr => {
        tr.classList.remove('highlight');
        const pathCell = tr.querySelector('td:nth-child(2)');
        if (pathCell && pathCell.textContent.trim().endsWith('.' + ext)) {
            tr.classList.add('highlight');
        }
    });
}

function highlightManualRowByReason(reason) {
    const reasonColMap = {
        "해시값 변경": 3,
        "권한 변경": 4,
        "UID 변경": 5,
        "GID 변경": 6,
        "CTime 변경": 7,
        "MTime 변경": 8,
        "크기 변경": 9
    };
    const colIdx = reasonColMap[reason];

    document.querySelectorAll('#manualScanTable tbody tr').forEach(tr => {
        tr.classList.remove('highlight');
        const td = tr.querySelector(`td:nth-child(${colIdx})`);
        if (td && td.dataset.changed === "true") {
            tr.classList.add('highlight');
        }
    });
}

function highlightManualRowByTime(timeLabel) {
    const startTime = new Date(timeLabel.replace(" ", "T") + ":00");
    const endTime = new Date(startTime.getTime() + 3 * 60 * 60 * 1000);

    document.querySelectorAll('#manualScanTable tbody tr').forEach(tr => {
        tr.classList.remove('highlight');
        const mtimeCell = tr.querySelector('td:nth-child(8)');
        if (mtimeCell) {
            const mtime = new Date(mtimeCell.textContent.trim().replace(" ", "T"));
            if (mtime >= startTime && mtime < endTime) {
                tr.classList.add('highlight');
            }
        }
    });
}

function highlightRealtimeRowByType(type) {
    const target = type.trim().toLowerCase();

    document.querySelectorAll('#realtimeTable tbody tr').forEach(tr => {
        tr.classList.remove('highlight');
        const td = tr.querySelector('td:nth-child(3)');
        if (td && td.textContent.trim().toLowerCase() === target) {
            tr.classList.add('highlight');
        }
    });

    const first = document.querySelector('#realtimeTable tbody tr.highlight');
    if (first) first.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function highlightRealtimeRowByTime(label) {
    const startTime = new Date(label.replace(" ", "T") + ":00");
    const endTime = new Date(startTime.getTime() + 3 * 60 * 60 * 1000);

    document.querySelectorAll('#realtimeTable tbody tr').forEach(tr => {
        tr.classList.remove('highlight');
        const td = tr.querySelector('td:nth-child(5)');
        if (td) {
            const eventTime = new Date(td.textContent.trim().replace(" ", "T"));
            if (eventTime >= startTime && eventTime < endTime) {
                tr.classList.add('highlight');
            }
        }
    });

    const first = document.querySelector('#realtimeTable tbody tr.highlight');
    if (first) first.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// File Extension 도넛
const extCtx = document.getElementById('manualScanExtChart').getContext('2d');
const extChart = new Chart(extCtx, {
    type: 'doughnut',
    data: {
        labels: ["txt"],
        datasets: [{
            data: [1],
            backgroundColor: ["rgba(255, 99, 132, 0.6)"]
        }]
    },
    options: {
        responsive: false,
        onClick: (evt) => {
            const points = extChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const label = extChart.data.labels[points[0].index];
                highlightManualRowByExt(label);
            }
        },
        plugins: {
            legend: { position: 'bottom' },
            datalabels: {
                color : '#000',
                font: { weight: 'bold' },
                formatter: (value) => value
            },
            title: {
                display: true,
                text: "File Extension",
                font: {size: 18, weight: 'bold' }
            }
        }
    },
    plugins: [ChartDataLabels] 
});

//도넛 요약 차트 표

(function() {
    const data = extChart.data;
    const total = data.datasets[0].data.reduce((sum, v) => sum + v, 0);
    let htmlLegend = '<table style="border-collapse: collapse; text-align: right;">';
    data.labels.forEach((label, i) => {
        const count = data.datasets[0].data[i];
        const pct   = ((count/total)*100).toFixed(2) + '%';
        const color = data.datasets[0].backgroundColor[i];
        htmlLegend += `
            <tr>
              <td style="padding:4px;">
                <span style="display:inline-block;width:12px;height:12px;
                          background-color:${color};margin-right:8px;"></span>
                ${label}
              </td>
              <td style="padding:4px;">${count}</td>
              <td style="padding:4px;">${pct}</td>
            </tr>`;
    });
    htmlLegend += '</table>';
    document.getElementById('manualScanExtLegend').innerHTML = htmlLegend;
})();

//File Change Reasons 막대 그래프
const reasonCtx = document.getElementById('manualScanReasonChart').getContext('2d');
const reasonChart = new Chart(reasonCtx, {
    type: 'bar',
    data: {
        labels: ["CTime 변경", "MTime 변경", "크기 변경", "해시값 변경"],
        datasets: [{
            label: '변경된 파일 수',
            data: [1, 1, 1, 1],
            backgroundColor: ["rgba(255, 99, 132, 0.6)", "rgba(54, 162, 235, 0.6)", "rgba(255, 206, 86, 0.6)", "rgba(75, 192, 192, 0.6)"]
        }]
    },
    options: {
        responsive: false,
        onClick: (evt) => {
            const points = reasonChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const label = reasonChart.data.labels[points[0].index];
                highlightManualRowByReason(label);
            }
        },

        plugins: {
            legend: { display: false },
            datalabels: {
                color : '#000',
                font: { weight: 'bold' },
                anchor: 'end',
                align: 'top',
                formatter: (value) => value
            },
            title: {
                display: true,
                text: "File Change Reasons",
                font: {size: 18, weight: 'bold' },
                padding: { bottom : 20}
            }
        },
        scales: {
            y:{
                beginAtZero: true,
                ticks:{
                    stepSize: 1,
                    precision: 0
                }
            }
        }
    },
    plugins: [ChartDataLabels]
});

//Modification By Time
const timeCtx = document.getElementById('manualScanTimeChart').getContext('2d');
    const timeChart = new Chart(timeCtx, {
        type: 'bar',
        data: {
            labels: ["2025-07-31 12:00", "2025-07-31 15:00", "2025-07-31 18:00", "2025-07-31 21:00", "2025-08-01 00:00", "2025-08-01 03:00", "2025-08-01 06:00", "2025-08-01 09:00", "2025-08-01 12:00"],
        datasets: [{
            label: '이벤트 수',
            data: [0, 0, 0, 0, 0, 0, 0, 0, 1],
            Color: ["rgba(255, 99, 132, 0.6)", "rgba(54, 162, 235, 0.6)", "rgba(255, 206, 86, 0.6)", "rgba(75, 192, 192, 0.6)", "rgba(153, 102, 255, 0.6)", "rgba(255, 159, 64, 0.6)", "rgba(44, 224, 148, 0.6)", "rgba(94, 48, 2, 0.6)", "rgba(144, 128, 112, 0.6)"]
        }]
    },
    options: {
        responsive: false,
        onClick: (evt) => {
            const points = timeChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const label = timeChart.data.labels[points[0].index];
                highlightManualRowByTime(label);
            }
        },
        plugins: {
            legend: { display: false },
            title: {
                display: true,
                text: ' Modification By Time',
                font: {size: 18, weight: 'bold' }
            },
            datalabels: {
                color: '#000',
                font: { weight: 'bold' },
                anchor: 'end',
                align: 'top',
                formatter: (v) => v
            }
        },
        scales: {
            x: {
                grid: { display: true, drawBorder: true },
                ticks: { autoSkip: false, maxRotation: 45, minRotation: 45 },
                title : {
                    display : false,
                    text : 'Time Interval (3hours)',
                    font: {
                        size : 13,
                        weight: 'bold'
                    },
                    padding: {top : 10},
                }
            },
            y: {
                beginAtZero: true,
                grid: { display: true },
                title: {
                    display: false,
                    text: 'Number of Events',
                    font: {
                        size: 13,
                        weight: 'bold'
                    },
                    padding: { bottom: 10 },
                }
            }
        }
    },
    plugins: [ChartDataLabels]
});

//Events By Type 막대 그래프
const rtCtx = document.getElementById('realtimeChart').getContext('2d');
const rtChart = new Chart(rtCtx, {
    type: 'bar',
    data: {
        labels: ["ATTRIB CHANGE  ", "MODIFY         "],
        datasets: [{
            label: 'Event Count',
            data: [1, 1],
            backgroundColor: ["rgba(255, 99, 132, 0.6)", "rgba(54, 162, 235, 0.6)"]
        }]
    },
    options: {
        responsive: false,
        onClick: (evt) => {
            const points = rtChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const label = rtChart.data.labels[points[0].index];
                highlightRealtimeRowByType(label);
            }
        },
        plugins: {
            legend: { display: false },
            title: {
                display: true,
                text: ' Events By Type',
                font: {size: 18, weight: 'bold' }
            },
            datalabels: {
                color : '#000',
                font: { weight: 'bold' },
                formatter: (value) => value
            }
        },
        scales: {
            y:{
                beginAtZero: true,
                ticks:{
                    stepSize: 1,
                    precision: 0
                }
            }
        }
    },
    plugins: [ChartDataLabels]
});

//Events by Time 시간 막대 그래프
const rtTimeCtx = document.getElementById('realtimeTimeChart').getContext('2d');
const rtTimeChart = new Chart(rtTimeCtx, {
    type: 'bar',
    data: {
        labels: ["2025-07-31 12:00", "2025-07-31 15:00", "2025-07-31 18:00", "2025-07-31 21:00", "2025-08-01 00:00", "2025-08-01 03:00", "2025-08-01 06:00", "2025-08-01 09:00", "2025-08-01 12:00"],
        datasets: [{
            label: 'Events By Time',
            data: [0, 0, 0, 0, 0, 0, 0, 0, 2],
            backgroundColor: ["rgba(255, 99, 132, 0.6)", "rgba(54, 162, 235, 0.6)", "rgba(255, 206, 86, 0.6)", "rgba(75, 192, 192, 0.6)", "rgba(153, 102, 255, 0.6)", "rgba(255, 159, 64, 0.6)", "rgba(44, 224, 148, 0.6)", "rgba(94, 48, 2, 0.6)", "rgba(144, 128, 112, 0.6)"
            ]
        }]
    },
    options: {
        responsive: false,
        onClick: (evt) => {
            const points = rtTimeChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const label = rtTimeChart.data.labels[points[0].index];
                highlightRealtimeRowByTime(label);
            }
        },
        plugins: {
            legend: { display: false },
            title: {
                display: true,
                text: 'Events by Time',
                font: {size: 18, weight: 'bold' }
            },
            datalabels: {
                color: '#000',
                font: { weight: 'bold' },
                anchor: 'end',
                align: 'top',
                formatter: (value) => value
            }
        },
        scales: {
            x: {
                grid: { display: true, drawBorder: true },
                ticks: { autoSkip: false, maxRotation: 45, minRotation: 45 },
                title : {
                    display : false,
                    text : 'Time Interval (3hours)',
                    font: {
                        size : 13,
                        weight: 'bold'
                    },
                    padding: {top : 10},
                }
            },
            y: {
                beginAtZero: true,
                grid: { display: true },
                title: {
                    display: false,
                    text: 'Number of Events',
                    font: {
                        size: 13,
                        weight: 'bold'
                    },
                    padding: { bottom: 10 },
                }
            }
        }
    },
    plugins: [ChartDataLabels]
});
</script>

<hr/>
<h1>🔍 Malware Scan Report</h1>
<h2>• Malware Scan Detection Overview</h2>
<canvas id="malwareScanDonutChart" width="400" height="400"></canvas>

<h2>• Scan Details</h2>
<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>ID</th>
            <th>File Path</th>
            <th>File Name</th>
            <th>Reason</th>
            <th>Malware Name / Rule</th>
            <th>Quarantine Success Status</th>
        </tr>
    </thead>
    <tbody>
<tr>
            <td colspan="7" style="text-align: center; font-style: italic;">
            No quarantined files found during this period.
            </td>
        </tr>
    </tbody>
</table>

<script>
const scanCtx = document.getElementById('malwareScanDonutChart').getContext('2d');
new Chart(scanCtx, {
    type: 'doughnut',
    data: {
        labels: ['Detected', 'Not Detected'],
        datasets: [{
            data: [0, 0],
            backgroundColor: [
                'rgba(255, 99, 132, 0.6)', // Detected (Red)
                'rgba(75, 192, 192, 0.6)'  // Not Detected (Cyan)
            ]
        }]
    },
    options: {
        responsive: false,
        plugins: {
            legend: { position: 'bottom' },
            datalabels: {
                color : '#000',
                font: { weight: 'bold' },
                formatter: (value) => value
            }
        }
    },
    plugins: [ChartDataLabels]
});
</script>

<hr/>
<h1>📜Malicious Behavior Report</h1>

<h2>• Malicious Behavior Overview</h2>
<div class="chart-row">
    <div class="chart-box">
        <canvas id="typeDonutChart" width="400" height="400"></canvas>
    </div>
    <div class="chart-box">
        <canvas id="userBarChart" width="400" height="400"></canvas>
    </div>
    <div class="chart-box">
        <canvas id="timeHistogram" width="400" height="400"></canvas>
    </div>
</div>

<h2>• Detected Malicious Behavior Details</h2>
<table id="LogDetailTable">
    <thead>
        <tr>
            <th>Event ID</th>
            <th>Type</th>
            <th>Description</th>
            <th>Timestamp</th>
            <th>Username</th>
            <th>Original Log Path</th>
        </tr>
    </thead>
    <tbody>
<tr><td><a href="#raw-1">1</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/local/bin/ManLab integscan</td><td>2025-07-31 22:30:18</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-2">2</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/bin/vi /root/ManLab/conf/ReportConfig.ini</td><td>2025-07-31 22:30:49</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-3">3</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/local/bin/ManLab baseline</td><td>2025-08-01 14:32:10</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-4">4</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/local/bin/ManLab baseline</td><td>2025-08-01 14:32:46</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-5">5</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/bin/vi /root/ManLab/conf/ReportConfig.ini</td><td>2025-08-01 14:33:21</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-6">6</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/bin/sqlite3 /root/ManLab/db/modifiedhash.db</td><td>2025-08-01 14:37:34</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-7">7</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/local/bin/ManLab baseline</td><td>2025-08-01 14:37:55</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-8">8</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/bin/vi /etc/test.txt</td><td>2025-08-01 14:38:35</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-9">9</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/local/bin/ManLab integscan</td><td>2025-08-01 14:38:49</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-10">10</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/bin/vi /root/ManLab/conf/ReportConfig.ini</td><td>2025-08-01 14:38:56</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
<tr><td><a href="#raw-11">11</a></td><td>T1548.003</td><td>비인가 사용자 yeji가 sudo 명령 사용 : /usr/bin/vi /root/ManLab/conf/ReportConfig.ini</td><td>2025-08-01 14:39:03</td><td>yeji</td><td>/var/log/manlab.log</td></tr>
</tbody>
</table>

<h2>• Event Log Line by ID</h2>
<table>
    <thead>
        <tr>
            <th>Event ID</th>
            <th>Raw Log Line</th>
        </tr>
    </thead>
    <tbody>
<tr id="raw-1"><td>1</td><td>2025-07-31T22:30:18.911329+09:00 ubuntu20 sudo:     yeji : TTY=pts/4 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/local/bin/ManLab integscan</td></tr>
<tr id="raw-2"><td>2</td><td>2025-07-31T22:30:49.749165+09:00 ubuntu20 sudo:     yeji : TTY=pts/4 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/bin/vi /root/ManLab/conf/ReportConfig.ini</td></tr>
<tr id="raw-3"><td>3</td><td>2025-08-01T14:32:10.436383+09:00 ubuntu20 sudo:     yeji : TTY=pts/0 ; PWD=/home/yeji ; USER=root ; COMMAND=/usr/local/bin/ManLab baseline</td></tr>
<tr id="raw-4"><td>4</td><td>2025-08-01T14:32:46.454821+09:00 ubuntu20 sudo:     yeji : TTY=pts/5 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/local/bin/ManLab baseline</td></tr>
<tr id="raw-5"><td>5</td><td>2025-08-01T14:33:21.029306+09:00 ubuntu20 sudo:     yeji : TTY=pts/5 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/bin/vi /root/ManLab/conf/ReportConfig.ini</td></tr>
<tr id="raw-6"><td>6</td><td>2025-08-01T14:37:34.349416+09:00 ubuntu20 sudo:     yeji : TTY=pts/5 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/bin/sqlite3 /root/ManLab/db/modifiedhash.db</td></tr>
<tr id="raw-7"><td>7</td><td>2025-08-01T14:37:55.942694+09:00 ubuntu20 sudo:     yeji : TTY=pts/5 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/local/bin/ManLab baseline</td></tr>
<tr id="raw-8"><td>8</td><td>2025-08-01T14:38:35.518018+09:00 ubuntu20 sudo:     yeji : TTY=pts/5 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/bin/vi /etc/test.txt</td></tr>
<tr id="raw-9"><td>9</td><td>2025-08-01T14:38:49.813471+09:00 ubuntu20 sudo:     yeji : TTY=pts/5 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/local/bin/ManLab integscan</td></tr>
<tr id="raw-10"><td>10</td><td>2025-08-01T14:38:56.994756+09:00 ubuntu20 sudo:     yeji : TTY=pts/5 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/bin/vi /root/ManLab/conf/ReportConfig.ini</td></tr>
<tr id="raw-11"><td>11</td><td>2025-08-01T14:39:03.089663+09:00 ubuntu20 sudo:     yeji : TTY=pts/5 ; PWD=/home/yeji/manlab/ManLab ; USER=root ; COMMAND=/usr/bin/vi /root/ManLab/conf/ReportConfig.ini</td></tr>
</tbody>
</table>

<script>
function highlightRowType(type) {
    console.log("highlightRow called with type:", type);

    document.querySelectorAll('table tbody tr').forEach(tr => {
        tr.classList.remove('highlight');
    });

    document.querySelectorAll('#LogDetailTable tbody tr').forEach(tr => {
        const td = tr.querySelector('td:nth-child(2)');
        if (td) {
            const cellText = td.textContent.trim();
            if (cellText === type) {
                tr.classList.add('highlight');
            }
        }
    });

    const firstHighlighted = document.querySelector('#LogDetailTable tbody tr.highlight');
    if (firstHighlighted) {
        firstHighlighted.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

function highlightRowUser(user) {
    console.log("highlightRow called with user:", user);

    document.querySelectorAll('table tbody tr').forEach(tr => {
        tr.classList.remove('highlight');
    });

    document.querySelectorAll('#LogDetailTable tbody tr').forEach(tr => {
        const td = tr.querySelector('td:nth-child(5)');
        if (td) {
            const cellText = td.textContent.trim();
            if (cellText === user) {
                tr.classList.add('highlight');
            }
        }
    });

    const firstHighlighted = document.querySelector('#LogDetailTable tbody tr.highlight');
    if (firstHighlighted) {
        firstHighlighted.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

function highlightRowTime(timeLabel) {
    console.log("highlightRow called with time:", timeLabel);

    const startTime = new Date(timeLabel.replace(" ", "T") + ":00");
    const endTime = new Date(startTime.getTime() + 3 * 60 * 60 * 1000); // +3시간

    document.querySelectorAll('table tbody tr').forEach(tr => {
        tr.classList.remove('highlight');
    });

    document.querySelectorAll('#LogDetailTable tbody tr').forEach(tr => {
        const td = tr.querySelector('td:nth-child(4)');
        if (td) {
            const cellText = td.textContent.trim();
            const eventTime = new Date(cellText.replace(" ", "T"));
            if (eventTime >= startTime && eventTime < endTime) {
                tr.classList.add('highlight');
            }
        }
    });

    const firstHighlighted = document.querySelector('#LogDetailTable tbody tr.highlight');
    if (firstHighlighted) {
        firstHighlighted.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

const logTypeCtx = document.getElementById('typeDonutChart').getContext('2d');
const logTypeChart = new Chart(logTypeCtx, {
    type: 'doughnut',
    data: {
        labels: ["T1548.003"],
        datasets: [{
            data: [11],
            backgroundColor: ["rgba(255, 99, 132, 0.6)"]
        }]
    },
    options: {
        responsive: false,
        plugins: {
            legend: { position: 'bottom' },
            datalabels: {
                color : '#000',
                font: { weight: 'bold' },
                formatter: (value) => value
            },
            title: { 
                display: true,
                text: "Malicious Behavior By Type",
                font: { size: 16, weight: 'bold' }
            }
        },
        onClick: (evt) => {
            const points = logTypeChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const index = points[0].index;
                const label = logTypeChart.data.labels[index];
                console.log("Clicked label:", label);
                highlightRowType(label);
            }
        }
    },
    plugins: [ChartDataLabels]
});

const logUserCtx = document.getElementById('userBarChart').getContext('2d');
const logUserChart = new Chart(logUserCtx, {
    type: 'bar',
    data: {
            labels: ["yeji"],
            datasets: [{
            label: 'Event Count',
            data: [11],
            backgroundColor: 'rgba(54,162,235,0.6)'
        }]
    },
    options: {
        indexAxis: 'y',
        responsive: false, 
        plugins: { 
            legend: { display: false },
            datalabels: {
                color: '#000',
                font: { weight: 'bold' },
                anchor: 'end',
                align: 'right'
            },
            title: { 
                display: true,
                text: "Malicious Behavior by Username",
                font: { size: 16, weight: 'bold' } 
            }
        },
        onClick: (evt) => {
            const points = logUserChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const index = points[0].index;
                const label = logUserChart.data.labels[index];
                console.log("Clicked label:", label);
                highlightRowUser(label);
            }
        }
    },
    plugins: [ChartDataLabels]
});

const logTimeCtx = document.getElementById('timeHistogram').getContext('2d');
const logTimeChart = new Chart(logTimeCtx, {
    type: 'bar',
    data: {
        labels: ["2025-07-31 12:00", "2025-07-31 15:00", "2025-07-31 18:00", "2025-07-31 21:00", "2025-08-01 00:00", "2025-08-01 03:00", "2025-08-01 06:00", "2025-08-01 09:00", "2025-08-01 12:00"],
        datasets: [{
            label: 'Event Count',
            data: [0, 0, 0, 2, 0, 0, 0, 0, 9],
            backgroundColor: 'rgba(255,99,132,0.6)'
        }]
    },
    options: {
        responsive: false,
        plugins: {
            legend: { display: false },
            datalabels: {
                color: '#000',
                font: { weight: 'bold' },
                anchor: 'end',
                align: 'top'
            },
            title: {
                display: true,
                text: "Malicious Behavior By Time",
                font: { size: 16, weight: 'bold' }
            }
        },
        onClick: (evt) => {
            const points = logTimeChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const index = points[0].index;
                const label = logTimeChart.data.labels[index];
                console.log("Clicked label:", label);
                highlightRowTime(label);
            }
        },
        scales: {
            x: {
                title: {
                    display: false,
                    text: 'Time Interval (3 hours)'
                }
            },
            y: {
                beginAtZero: true,
                title: {
                    display: false,
                    text: 'Number of Events'
                }
            }
        }
    },
    plugins: [ChartDataLabels]
});
</script>

</body>
</html>
